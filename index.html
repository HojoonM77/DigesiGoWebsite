<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DigesiGo â€” AI Gut Health Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:        #080c08;
      --surface:   #0f150f;
      --surface2:  #162016;
      --surface3:  #1c2a1c;
      --border:    #1e3320;
      --green:     #00e676;
      --green-dim: #00c853;
      --green-dark:#004d20;
      --green-glow:rgba(0,230,118,.18);
      --text:      #d4e8d4;
      --text-dim:  #7a9b7a;
      --text-muted:#3d5c3d;
      --user-bubble:#0d2e1a;
      --ai-bubble:  #0f1f0f;
      --danger:    #ff5252;
      --warn:      #ffab40;
      --font: 'Segoe UI', system-ui, -apple-system, sans-serif;
      --mono: 'Courier New', monospace;
    }
    html, body, #root { height: 100%; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      font-size: 14px;
      line-height: 1.5;
      overflow: hidden;
    }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--surface); }
    ::-webkit-scrollbar-thumb { background: var(--green-dark); border-radius: 3px; }

    /* â”€â”€ App Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app { display: flex; flex-direction: column; height: 100vh; }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 24px;
      height: 56px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      z-index: 10;
    }
    .logo {
      display: flex; align-items: center; gap: 10px;
      font-size: 18px; font-weight: 700; letter-spacing: -.3px;
    }
    .logo-icon {
      width: 32px; height: 32px;
      background: var(--green);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .logo span { color: var(--green); }
    .header-right { display: flex; align-items: center; gap: 16px; }
    .status-pill {
      display: flex; align-items: center; gap: 6px;
      padding: 4px 12px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px; color: var(--text-dim);
    }
    .status-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--green);
      box-shadow: 0 0 6px var(--green);
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
    .date-badge {
      font-size: 12px; color: var(--text-muted);
      font-family: var(--mono);
    }

    /* â”€â”€ Nav Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nav { display:flex; gap:2px; padding:0 24px; background:var(--surface); border-bottom:1px solid var(--border); flex-shrink:0; }
    .nav-btn {
      padding: 12px 20px;
      background: none; border: none; cursor: pointer;
      color: var(--text-dim); font-size: 13px; font-family: var(--font);
      border-bottom: 2px solid transparent;
      transition: all .2s;
      display: flex; align-items: center; gap: 7px;
    }
    .nav-btn:hover { color: var(--text); }
    .nav-btn.active { color: var(--green); border-bottom-color: var(--green); }
    .nav-btn .badge {
      background: var(--green-dark); color: var(--green);
      font-size: 10px; padding: 1px 6px; border-radius: 10px; font-weight: 600;
    }

    /* â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main { flex: 1; overflow: hidden; display: flex; }

    /* â”€â”€ CHAT PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-page { display:flex; width:100%; height:100%; }
    .chat-sidebar {
      width: 260px; flex-shrink:0;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex; flex-direction: column;
      overflow: hidden;
    }
    .sidebar-section { padding: 16px; border-bottom: 1px solid var(--border); }
    .sidebar-title { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-bottom: 12px; }
    .quick-stat {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 10px; margin-bottom: 6px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
    }
    .qs-left { display:flex; align-items:center; gap:8px; }
    .qs-icon { font-size:15px; }
    .qs-label { font-size:12px; color:var(--text-dim); }
    .qs-val { font-size:13px; font-weight:600; color:var(--green); font-family:var(--mono); }
    .sidebar-tips { padding:16px; overflow-y:auto; flex:1; }
    .tip-item {
      padding: 8px 10px; margin-bottom:8px;
      background: var(--surface2); border:1px solid var(--border);
      border-radius: 8px; font-size:11px; color:var(--text-dim);
      display:flex; gap:8px; align-items:flex-start;
    }
    .tip-item .icon { color:var(--green); flex-shrink:0; }
    .prompt-chip-list { display:flex; flex-direction:column; gap:6px; }
    .prompt-chip {
      padding:8px 10px;
      background:var(--surface2); border:1px solid var(--border);
      border-radius:8px; cursor:pointer; font-size:11px; color:var(--text-dim);
      text-align:left; font-family:var(--font);
      transition:all .15s;
    }
    .prompt-chip:hover { border-color:var(--green-dim); color:var(--text); background:var(--surface3); }

    /* Chat area */
    .chat-main { flex:1; display:flex; flex-direction:column; overflow:hidden; }
    .chat-messages {
      flex:1; overflow-y:auto; padding:24px 28px;
      display:flex; flex-direction:column; gap:16px;
    }
    .msg { display:flex; gap:10px; max-width:72%; animation: fadeUp .25s ease; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
    .msg.user { align-self:flex-end; flex-direction:row-reverse; }
    .msg.ai { align-self:flex-start; }
    .avatar {
      width:32px; height:32px; border-radius:50%; flex-shrink:0;
      display:flex; align-items:center; justify-content:center; font-size:15px;
    }
    .avatar.ai { background:var(--green-dark); border:1px solid var(--green-dim); color:var(--green); }
    .avatar.user { background:var(--surface3); border:1px solid var(--border); }
    .bubble {
      padding:10px 14px; border-radius:16px; font-size:13px; line-height:1.55;
    }
    .msg.user .bubble { background:var(--user-bubble); border:1px solid #1a4a2e; border-bottom-right-radius:4px; }
    .msg.ai .bubble { background:var(--ai-bubble); border:1px solid var(--border); border-bottom-left-radius:4px; }
    .bubble-meta { font-size:10px; color:var(--text-muted); margin-top:4px; }
    .msg.user .bubble-meta { text-align:right; }

    /* Logged cards inside bubbles */
    .log-card {
      margin-top: 8px; padding: 8px 10px;
      background: var(--surface2); border:1px solid var(--green-dark);
      border-radius: 8px; font-size: 11px;
    }
    .log-card-title { color:var(--green); font-weight:600; margin-bottom:4px; font-size:11px; }
    .log-card-row { display:flex; justify-content:space-between; color:var(--text-dim); padding:2px 0; }
    .log-card-val { color:var(--text); font-family:var(--mono); }

    /* Typing indicator */
    .typing { display:flex; align-items:center; gap:4px; padding:12px 14px; }
    .typing span {
      width:7px; height:7px; border-radius:50%; background:var(--green);
      animation: blink 1.2s infinite;
    }
    .typing span:nth-child(2){animation-delay:.2s}
    .typing span:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}

    /* Chat input */
    .chat-input-wrap {
      padding:16px 28px; border-top:1px solid var(--border);
      background:var(--surface); flex-shrink:0;
    }
    .chat-input-row { display:flex; gap:10px; align-items:flex-end; }
    .chat-textarea {
      flex:1; padding:10px 14px;
      background:var(--surface2); border:1px solid var(--border);
      border-radius:12px; color:var(--text); font-family:var(--font); font-size:13px;
      resize:none; min-height:42px; max-height:120px;
      transition:border-color .2s;
      outline:none;
    }
    .chat-textarea:focus { border-color:var(--green-dim); }
    .chat-textarea::placeholder { color:var(--text-muted); }
    .send-btn {
      width:42px; height:42px; border-radius:12px;
      background:var(--green); border:none; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      color:#000; font-size:18px; transition:all .15s; flex-shrink:0;
    }
    .send-btn:hover { background:#00ff88; box-shadow:0 0 16px var(--green-glow); }
    .send-btn:disabled { background:var(--green-dark); color:var(--text-muted); cursor:not-allowed; }
    .input-hints { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
    .hint-chip {
      padding:3px 9px; background:var(--surface2); border:1px solid var(--border);
      border-radius:10px; font-size:11px; color:var(--text-muted); cursor:pointer;
      transition:all .15s;
    }
    .hint-chip:hover { border-color:var(--green-dim); color:var(--text); }

    /* â”€â”€ DASHBOARD PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .dashboard { width:100%; height:100%; overflow-y:auto; padding:24px 28px; }
    .dash-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-bottom:20px; }
    .stat-card {
      padding:16px 18px;
      background:var(--surface); border:1px solid var(--border);
      border-radius:12px; position:relative; overflow:hidden;
    }
    .stat-card::before {
      content:''; position:absolute; top:0; left:0; right:0; height:2px;
      background:var(--green);
    }
    .stat-card .sc-label { font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.8px; }
    .stat-card .sc-val { font-size:28px; font-weight:700; color:var(--green); font-family:var(--mono); margin:4px 0 2px; }
    .stat-card .sc-sub { font-size:11px; color:var(--text-dim); }
    .stat-card .sc-icon { position:absolute; top:14px; right:14px; font-size:22px; opacity:.3; }

    .dash-row { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:20px; }
    .dash-row.three { grid-template-columns:1fr 1fr 1fr; }
    .panel {
      background:var(--surface); border:1px solid var(--border);
      border-radius:12px; padding:18px 20px;
    }
    .panel-title { font-size:12px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.8px; margin-bottom:16px; display:flex; align-items:center; gap:8px; }
    .panel-title .dot { width:7px;height:7px;border-radius:50%;background:var(--green); }

    /* Bar chart */
    .bar-chart { display:flex; align-items:flex-end; gap:8px; height:100px; }
    .bar-col { flex:1; display:flex; flex-direction:column; align-items:center; gap:4px; }
    .bar { width:100%; border-radius:4px 4px 0 0; background:var(--green-dark); transition:height .4s ease; position:relative; }
    .bar.active { background:var(--green); box-shadow:0 0 8px var(--green-glow); }
    .bar-label { font-size:10px; color:var(--text-muted); font-family:var(--mono); }
    .bar-val { font-size:9px; color:var(--text-dim); position:absolute; top:-14px; width:100%; text-align:center; }

    /* Line chart SVG */
    .line-chart-wrap { width:100%; height:110px; }

    /* Log table */
    .log-table { width:100%; border-collapse:collapse; }
    .log-table th { font-size:10px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.8px; text-align:left; padding:0 0 10px; border-bottom:1px solid var(--border); }
    .log-table td { padding:8px 0; border-bottom:1px solid #0e1e0e; font-size:12px; vertical-align:middle; }
    .log-table tr:last-child td { border-bottom:none; }
    .tag {
      display:inline-block; padding:2px 8px; border-radius:10px; font-size:10px;
      font-weight:600; text-transform:uppercase; letter-spacing:.5px;
    }
    .tag.food   { background:#0a2e1a; color:#69f0ae; }
    .tag.active { background:#0a1a2e; color:#40c4ff; }
    .tag.symptom{ background:#2e1a0a; color:#ffab40; }
    .tag.energy { background:#1a0a2e; color:#ce93d8; }

    /* Symptom severity gauge */
    .gauge-list { display:flex; flex-direction:column; gap:10px; }
    .gauge-item { display:flex; flex-direction:column; gap:4px; }
    .gauge-row { display:flex; justify-content:space-between; font-size:11px; }
    .gauge-label { color:var(--text-dim); }
    .gauge-val { color:var(--text); font-family:var(--mono); }
    .gauge-bar { height:6px; border-radius:3px; background:var(--surface3); overflow:hidden; }
    .gauge-fill { height:100%; border-radius:3px; transition:width .6s ease; }

    /* Energy ring */
    .energy-ring { display:flex; align-items:center; gap:16px; }
    .ring-svg { flex-shrink:0; }
    .ring-info { display:flex; flex-direction:column; gap:6px; }
    .ring-stat { display:flex; align-items:center; gap:8px; font-size:12px; }
    .ring-dot { width:8px;height:8px;border-radius:50%; }

    /* Insight cards */
    .insight-list { display:flex; flex-direction:column; gap:10px; }
    .insight-card {
      padding:10px 12px; border-radius:8px; font-size:12px;
      border-left:3px solid var(--green); background:var(--surface2);
      color:var(--text-dim);
    }
    .insight-card.warn { border-left-color:var(--warn); }
    .insight-card.danger { border-left-color:var(--danger); }
    .insight-card strong { color:var(--text); display:block; margin-bottom:2px; font-size:11px; }

    /* â”€â”€ HISTORY PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .history-page { width:100%; height:100%; overflow-y:auto; padding:24px 28px; }
    .timeline { display:flex; flex-direction:column; gap:0; }
    .timeline-day { margin-bottom:24px; }
    .timeline-date {
      font-size:11px; color:var(--green); font-family:var(--mono);
      text-transform:uppercase; letter-spacing:1px;
      margin-bottom:12px; display:flex; align-items:center; gap:10px;
    }
    .timeline-date::after { content:''; flex:1; height:1px; background:var(--border); }
    .timeline-entries { display:flex; flex-direction:column; gap:8px; }
    .tl-entry {
      display:flex; gap:14px; align-items:flex-start;
      padding:10px 14px; border-radius:10px;
      background:var(--surface); border:1px solid var(--border);
    }
    .tl-time { font-size:11px; color:var(--text-muted); font-family:var(--mono); min-width:42px; padding-top:1px; }
    .tl-icon { font-size:16px; min-width:20px; }
    .tl-body { flex:1; }
    .tl-title { font-size:13px; color:var(--text); margin-bottom:2px; }
    .tl-detail { font-size:11px; color:var(--text-dim); }

    /* Empty state */
    .empty-state { text-align:center; padding:60px 20px; color:var(--text-muted); }
    .empty-state .es-icon { font-size:48px; margin-bottom:12px; }
    .empty-state p { font-size:14px; margin-bottom:6px; color:var(--text-dim); }
    .empty-state small { font-size:12px; }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

/* â”€â”€â”€ AI Response Engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const INTENTS = {
  food: /ate|eat|eaten|had|breakfast|lunch|dinner|snack|meal|drank|drink|drank|consumed|calories|fiber|protein|carbs|fat|burger|pizza|salad|fruit|vegetable|soup|rice|bread|pasta|coffee|tea|water|juice|smoothie|yogurt|oats|egg|chicken|fish|beef/i,
  activity: /walk|walked|run|ran|jog|jogged|exercise|gym|swim|swam|yoga|cycle|biked|steps|workout|training|stretch|squat|lift|hiit|cardio|active|sport/i,
  symptom: /bloat|bloating|gas|gassy|cramp|cramping|pain|ache|constipat|diarrhea|nausea|nauseous|stool|bowel|ibs|reflux|heartburn|indigestion|burp|full|uncomfortable|distended/i,
  energy: /tired|fatigue|exhausted|energy|energetic|sluggish|alert|awake|sleepy|refresh|motivated|lazy|lethargic|mood|feel|feeling/i,
};

const FOOD_PARSE = /(\d+)?\s*(cal|calorie|kcal)/i;
const FIBER_PARSE = /(\d+)\s*g?\s*(fiber|fibre)/i;

function parseFood(text) {
  const cals = text.match(FOOD_PARSE);
  const fiber = text.match(FIBER_PARSE);
  const portions = text.match(/(\d+)\s*(cup|bowl|piece|slice|serving|gram|oz|ml)/i);
  return {
    calories: cals ? parseInt(cals[1]) : Math.floor(Math.random()*400)+100,
    fiber: fiber ? parseInt(fiber[1]) : Math.floor(Math.random()*8)+1,
    portion: portions ? portions[0] : '1 serving',
  };
}

function detectFood(text) {
  const foods = ['oatmeal','eggs','toast','yogurt','salad','pasta','rice','soup','chicken','fish','fruits','vegetables','sandwich','coffee','tea','water','smoothie','steak','salmon','avocado','pizza','burger','broccoli'];
  return foods.filter(f => text.toLowerCase().includes(f));
}

function detectActivity(text) {
  const acts = ['walk','run','jog','yoga','gym','swim','cycle','hike','stretch','lift','cardio','hiit'];
  return acts.filter(a => text.toLowerCase().includes(a));
}

function detectSymptoms(text) {
  const syms = ['bloating','gas','cramping','pain','nausea','constipation','diarrhea','reflux','heartburn','discomfort','indigestion','fullness'];
  return syms.filter(s => text.toLowerCase().includes(s));
}

const SEVERITY = { mild:1, moderate:2, severe:3, bad:2, terrible:3, slight:1, little:1, lot:3, intense:3 };
function parseSeverity(text) {
  for (const [k,v] of Object.entries(SEVERITY)) if (text.toLowerCase().includes(k)) return v;
  return 2;
}

const RESPONSES = {
  food: (items, data) => {
    const itemStr = items.length ? items.join(', ') : 'your meal';
    const fibNote = data.fiber >= 5 ? 'Great fiber content â€” this supports gut motility!' : data.fiber <= 2 ? 'That\'s low in fiber. Consider adding leafy greens or legumes.' : 'Decent fiber intake.';
    return {
      text: `Logged! I recorded **${itemStr}** (~${data.calories} kcal, ${data.fiber}g fiber). ${fibNote} How\'s your digestive comfort after eating?`,
      card: { type:'food', title:'ğŸ¥¦ Food Log', data: { 'Item(s)': itemStr, 'Est. Calories': `${data.calories} kcal`, 'Fiber': `${data.fiber}g`, 'Portion': data.portion } }
    };
  },
  activity: (acts, text) => {
    const actStr = acts.length ? acts.join(', ') : 'activity';
    const durationMatch = text.match(/(\d+)\s*(min|minute|hour|hr)/i);
    const duration = durationMatch ? durationMatch[0] : '30 min';
    const steps = text.match(/(\d[\d,]+)\s*step/i);
    return {
      text: `Activity logged! ${actStr} for ${duration} is excellent for gut motility â€” physical activity stimulates peristalsis and can reduce bloating. Keep it up! Any digestive symptoms before or after?`,
      card: { type:'activity', title:'ğŸƒ Activity Log', data: { 'Activity': actStr, 'Duration': duration, 'Steps': steps ? steps[1] : 'N/A', 'Gut Benefit': 'Motility â†‘' } }
    };
  },
  symptom: (syms, text) => {
    const severity = parseSeverity(text);
    const sevLabel = ['','Mild','Moderate','Severe'][severity];
    const symStr = syms.length ? syms.join(', ') : 'symptom';
    const tips = {
      bloating:'Try peppermint tea or a gentle walk. Avoid carbonated drinks.',
      gas:'Reduce FODMAP foods like beans, lentils, onions temporarily.',
      cramping:'Stay hydrated and apply a warm compress to the abdomen.',
      nausea:'Ginger tea or small sips of water may help. Rest upright.',
      reflux:'Avoid lying down for 2â€“3 hours after eating. Elevate head during sleep.',
    };
    const tip = tips[syms[0]] || 'Stay hydrated and rest. Track if it worsens.';
    return {
      text: `Symptom logged as **${sevLabel} ${symStr}**. ${tip} I\'ll track this pattern over time. When did this start â€” before or after a meal?`,
      card: { type:'symptom', title:'âš ï¸ Symptom Log', data: { 'Symptom': symStr, 'Severity': sevLabel + ` (${severity}/3)`, 'Tip': tip.slice(0,30)+'...' } }
    };
  },
  energy: (text) => {
    const level = /high|great|good|energetic|great|alert|refresh|motivated/i.test(text) ? 'High' : /low|tired|fatigue|slug|exhaust|letharg/i.test(text) ? 'Low' : 'Moderate';
    const score = level==='High' ? 8 : level==='Low' ? 3 : 5;
    const note = level==='Low' ? 'Low energy can be linked to gut inflammation or poor nutrient absorption. Try a light protein snack and stay hydrated.' : level==='High' ? 'Great! High energy often correlates with good gut health and balanced nutrition.' : 'Moderate energy. Ensure you\'re hitting your fiber and hydration targets.';
    return {
      text: `Energy logged as **${level}** (${score}/10). ${note}`,
      card: { type:'energy', title:'âš¡ Energy Log', data: { 'Level': level, 'Score': `${score}/10`, 'Linked to': 'Gut absorption', 'Note': note.slice(0,25)+'...' } }
    };
  },
  greeting: () => ({ text: 'Hey! I\'m DigestiBot, your gut health AI assistant ğŸŒ¿ Tell me what you\'ve eaten, any activity you\'ve done, digestive symptoms you\'re experiencing, or how your energy feels. I\'ll track it all and help you understand your gut patterns.', card: null }),
  help: () => ({ text: 'I can track:\nâ€¢ **ğŸ¥¦ Food & Diet** â€” "I had oatmeal for breakfast with 4g fiber"\nâ€¢ **ğŸƒ Activity** â€” "I went for a 30-minute jog"\nâ€¢ **âš ï¸ Symptoms** â€” "I\'m experiencing mild bloating after lunch"\nâ€¢ **âš¡ Energy** â€” "Feeling low energy this afternoon"\n\nJust tell me naturally and I\'ll log it!', card: null }),
  fallback: () => ({ text: 'I\'m here to help track your gut health! Tell me about a meal you had, physical activity, any digestive symptoms, or your energy level. You can speak naturally â€” I\'ll pick up the details.', card: null }),
};

function generateResponse(text) {
  const lower = text.toLowerCase();
  if (/^(hi|hello|hey|good morning|good evening|howdy)/i.test(lower.trim())) return RESPONSES.greeting();
  if (/help|what can you|how do i|how does/i.test(lower)) return RESPONSES.help();
  if (INTENTS.symptom.test(text)) { const s=detectSymptoms(text); return RESPONSES.symptom(s,text); }
  if (INTENTS.food.test(text)) { const items=detectFood(text); const data=parseFood(text); return RESPONSES.food(items,data); }
  if (INTENTS.activity.test(text)) { const acts=detectActivity(text); return RESPONSES.activity(acts,text); }
  if (INTENTS.energy.test(text)) return RESPONSES.energy(text);
  return RESPONSES.fallback();
}

/* â”€â”€â”€ Chart Components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function BarChart({ data, color = '#00e676' }) {
  const max = Math.max(...data.map(d => d.val), 1);
  return (
    <div className="bar-chart">
      {data.map((d, i) => (
        <div key={i} className="bar-col">
          <div className={`bar ${d.today ? 'active' : ''}`} style={{ height: `${(d.val/max)*80}px`, background: d.today ? color : undefined }}>
            <span className="bar-val">{d.val}</span>
          </div>
          <span className="bar-label">{d.label}</span>
        </div>
      ))}
    </div>
  );
}

function LineChart({ data, color = '#00e676' }) {
  const W = 320, H = 90, PAD = 10;
  const vals = data.map(d => d.val);
  const max = Math.max(...vals, 1), min = Math.min(...vals, 0);
  const range = max - min || 1;
  const pts = vals.map((v, i) => {
    const x = PAD + (i / (vals.length - 1)) * (W - PAD * 2);
    const y = PAD + (1 - (v - min) / range) * (H - PAD * 2);
    return [x, y];
  });
  const polyline = pts.map(p => p.join(',')).join(' ');
  const area = `${pts[0][0]},${H} ${polyline} ${pts[pts.length-1][0]},${H}`;
  return (
    <div className="line-chart-wrap">
      <svg viewBox={`0 0 ${W} ${H}`} width="100%" height="100%" preserveAspectRatio="none">
        <defs>
          <linearGradient id={`grad-${color.replace('#','')}`} x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stopColor={color} stopOpacity=".3"/>
            <stop offset="100%" stopColor={color} stopOpacity="0"/>
          </linearGradient>
        </defs>
        <polygon points={area} fill={`url(#grad-${color.replace('#','')})`}/>
        <polyline points={polyline} fill="none" stroke={color} strokeWidth="2" strokeLinejoin="round" strokeLinecap="round"/>
        {pts.map(([x,y],i) => <circle key={i} cx={x} cy={y} r={i===pts.length-1?4:2.5} fill={i===pts.length-1?color:'#0f150f'} stroke={color} strokeWidth="1.5"/>)}
      </svg>
    </div>
  );
}

function GaugeBar({ label, val, max, color }) {
  const pct = Math.round((val/max)*100);
  return (
    <div className="gauge-item">
      <div className="gauge-row"><span className="gauge-label">{label}</span><span className="gauge-val">{val}/{max}</span></div>
      <div className="gauge-bar"><div className="gauge-fill" style={{width:`${pct}%`,background:color}}/></div>
    </div>
  );
}

function EnergyRing({ score }) {
  const R = 36, C = 2*Math.PI*R;
  const pct = score/10;
  const dash = C*pct, gap = C*(1-pct);
  return (
    <svg className="ring-svg" width="90" height="90" viewBox="0 0 90 90">
      <circle cx="45" cy="45" r={R} fill="none" stroke="#162016" strokeWidth="8"/>
      <circle cx="45" cy="45" r={R} fill="none" stroke="#00e676" strokeWidth="8"
        strokeDasharray={`${dash} ${gap}`} strokeLinecap="round"
        transform="rotate(-90 45 45)" style={{transition:'stroke-dasharray .6s ease'}}/>
      <text x="45" y="48" textAnchor="middle" fill="#00e676" fontSize="16" fontWeight="700" fontFamily="Courier New">{score}</text>
      <text x="45" y="60" textAnchor="middle" fill="#7a9b7a" fontSize="9">/10</text>
    </svg>
  );
}

/* â”€â”€â”€ Mock data seeder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function seedData() {
  const days = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  return {
    calorieWeek: days.map((d,i) => ({ label:d, val:[1800,2100,1650,2200,1900,2400,1750][i], today:i===6 })),
    fiberWeek:   days.map((d,i) => ({ label:d, val:[22,18,28,15,24,30,19][i], today:i===6 })),
    stepsWeek:   days.map((d,i) => ({ label:d, val:[6200,8100,4500,9200,7400,10500,5800][i], today:i===6 })),
    energyWeek:  days.map((d,i) => ({ label:d, val:[6,7,5,8,6,9,5][i] })),
    symptoms:    [
      { label:'Bloating', val:2, max:5, color:'#ffab40' },
      { label:'Gas', val:1, max:5, color:'#ff7043' },
      { label:'Cramping', val:1, max:5, color:'#ff5252' },
      { label:'Nausea', val:0, max:5, color:'#ab47bc' },
      { label:'Reflux', val:0, max:5, color:'#ef5350' },
    ],
    todayStats: { calories:1750, fiber:19, steps:5800, energy:5, water:6, meals:3 },
  };
}

/* â”€â”€â”€ Hint chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const HINTS = [
  'I had oatmeal for breakfast',
  'Went for a 20-min walk',
  'Mild bloating after dinner',
  'Feeling low energy today',
  'Drank 8 glasses of water',
];
const SIDEBAR_PROMPTS = [
  'ğŸ¥‘ Log a meal',
  'ğŸƒ Log an activity',
  'ğŸ˜£ Log a symptom',
  'âš¡ Log my energy',
  'ğŸ’§ Log water intake',
];

/* â”€â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function App() {
  const [tab, setTab] = useState('chat');
  const [messages, setMessages] = useState([
    { id:1, role:'ai', text:'Hello! I\'m **DigestiBot**, your AI gut health companion ğŸŒ¿\n\nI\'m here to help you track your **diet**, **activity**, **digestive symptoms**, and **energy levels** â€” all through natural conversation.\n\nTell me what you\'ve eaten today, any symptoms you\'re feeling, or activities you\'ve done, and I\'ll log everything and offer digestive health insights!', card:null, time:'09:00' }
  ]);
  const [input, setInput] = useState('');
  const [typing, setTyping] = useState(false);
  const [logCount, setLogCount] = useState(0);
  const [logs, setLogs] = useState([]);
  const [seedD] = useState(seedData);
  const messagesEndRef = useRef(null);
  const textareaRef = useRef(null);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior:'smooth' });
  }, [messages, typing]);

  const now = () => new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:false});
  const today = new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});

  const sendMessage = useCallback(() => {
    const text = input.trim();
    if (!text) return;
    const userMsg = { id:Date.now(), role:'user', text, card:null, time:now() };
    setMessages(m => [...m, userMsg]);
    setInput('');
    setTyping(true);
    setTimeout(() => {
      const resp = generateResponse(text);
      const aiMsg = { id:Date.now()+1, role:'ai', text:resp.text, card:resp.card, time:now() };
      setMessages(m => [...m, aiMsg]);
      setTyping(false);
      if (resp.card) {
        setLogCount(c => c+1);
        setLogs(l => [{ ...resp.card, timestamp: now(), raw: text }, ...l]);
      }
    }, 1200 + Math.random()*600);
  }, [input]);

  const handleKey = (e) => {
    if (e.key==='Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  };

  const renderMarkdown = (text) => {
    return text
      .replace(/\*\*(.+?)\*\*/g, '<strong style="color:#d4e8d4">$1</strong>')
      .replace(/\n/g, '<br/>');
  };

  const stats = seedD.todayStats;

  return (
    <div className="app">
      {/* Header */}
      <header className="header">
        <div className="logo">
          <div className="logo-icon">ğŸ«</div>
          Digesi<span>Go</span>
        </div>
        <div className="header-right">
          <div className="status-pill"><div className="status-dot"/><span>AI Active</span></div>
          <span className="date-badge">{today}</span>
        </div>
      </header>

      {/* Nav */}
      <nav className="nav">
        {[
          { id:'chat', icon:'ğŸ’¬', label:'Chat Tracker', badge: logCount > 0 ? logCount : null },
          { id:'dashboard', icon:'ğŸ“Š', label:'Dashboard' },
          { id:'history', icon:'ğŸ“‹', label:'Log History', badge: logs.length > 0 ? logs.length : null },
        ].map(t => (
          <button key={t.id} className={`nav-btn ${tab===t.id?'active':''}`} onClick={()=>setTab(t.id)}>
            {t.icon} {t.label}
            {t.badge && <span className="badge">{t.badge}</span>}
          </button>
        ))}
      </nav>

      {/* Main */}
      <main className="main">

        {/* â”€â”€ CHAT TAB â”€â”€ */}
        {tab==='chat' && (
          <div className="chat-page">
            {/* Sidebar */}
            <aside className="chat-sidebar">
              <div className="sidebar-section">
                <div className="sidebar-title">Today's Stats</div>
                {[
                  { icon:'ğŸ½ï¸', label:'Calories', val:`${stats.calories} kcal` },
                  { icon:'ğŸŒ¾', label:'Fiber', val:`${stats.fiber}g` },
                  { icon:'ğŸ‘Ÿ', label:'Steps', val:stats.steps.toLocaleString() },
                  { icon:'âš¡', label:'Energy', val:`${stats.energy}/10` },
                  { icon:'ğŸ’§', label:'Water', val:`${stats.water} glasses` },
                ].map(s => (
                  <div key={s.label} className="quick-stat">
                    <div className="qs-left"><span className="qs-icon">{s.icon}</span><span className="qs-label">{s.label}</span></div>
                    <span className="qs-val">{s.val}</span>
                  </div>
                ))}
              </div>
              <div className="sidebar-section">
                <div className="sidebar-title">Quick Log</div>
                <div className="prompt-chip-list">
                  {SIDEBAR_PROMPTS.map(p => (
                    <button key={p} className="prompt-chip" onClick={()=>setInput(p.slice(2).trim())}>{p}</button>
                  ))}
                </div>
              </div>
              <div className="sidebar-tips">
                <div className="sidebar-title">Gut Insights</div>
                {[
                  { icon:'ğŸŒ¿', text:'Aim for 25â€“38g of fiber daily for optimal gut health.' },
                  { icon:'ğŸ’§', text:'8+ glasses of water supports bowel regularity.' },
                  { icon:'ğŸš¶', text:'Even a 10-min walk after meals reduces bloating.' },
                  { icon:'ğŸ§˜', text:'Stress directly impacts your gut microbiome.' },
                ].map((tip,i) => (
                  <div key={i} className="tip-item"><span className="icon">{tip.icon}</span><span>{tip.text}</span></div>
                ))}
              </div>
            </aside>

            {/* Chat main */}
            <div className="chat-main">
              <div className="chat-messages">
                {messages.map(msg => (
                  <div key={msg.id} className={`msg ${msg.role}`}>
                    <div className={`avatar ${msg.role}`}>{msg.role==='ai'?'ğŸ¤–':'ğŸ‘¤'}</div>
                    <div>
                      <div className="bubble">
                        <span dangerouslySetInnerHTML={{__html: renderMarkdown(msg.text)}}/>
                        {msg.card && (
                          <div className="log-card">
                            <div className="log-card-title">{msg.card.title} â€” Logged</div>
                            {Object.entries(msg.card.data).map(([k,v]) => (
                              <div key={k} className="log-card-row"><span>{k}</span><span className="log-card-val">{v}</span></div>
                            ))}
                          </div>
                        )}
                      </div>
                      <div className="bubble-meta">{msg.time}</div>
                    </div>
                  </div>
                ))}
                {typing && (
                  <div className="msg ai">
                    <div className="avatar ai">ğŸ¤–</div>
                    <div className="bubble"><div className="typing"><span/><span/><span/></div></div>
                  </div>
                )}
                <div ref={messagesEndRef}/>
              </div>
              <div className="chat-input-wrap">
                <div className="chat-input-row">
                  <textarea
                    ref={textareaRef}
                    className="chat-textarea"
                    value={input}
                    onChange={e=>setInput(e.target.value)}
                    onKeyDown={handleKey}
                    placeholder="Tell me what you ate, how you feel, or any symptomsâ€¦ (Enter to send)"
                    rows={1}
                  />
                  <button className="send-btn" onClick={sendMessage} disabled={!input.trim()||typing}>â¤</button>
                </div>
                <div className="input-hints">
                  {HINTS.map(h=>(
                    <button key={h} className="hint-chip" onClick={()=>setInput(h)}>{h}</button>
                  ))}
                </div>
              </div>
            </div>
          </div>
        )}

        {/* â”€â”€ DASHBOARD TAB â”€â”€ */}
        {tab==='dashboard' && (
          <div className="dashboard">
            {/* Stat cards */}
            <div className="dash-grid">
              {[
                { label:'Calories Today', val:'1,750', sub:'of 2,000 goal', icon:'ğŸ½ï¸' },
                { label:'Fiber Intake', val:'19g', sub:'of 30g recommended', icon:'ğŸŒ¾' },
                { label:'Steps Today', val:'5,800', sub:'+12% vs avg', icon:'ğŸ‘Ÿ' },
                { label:'Energy Score', val:'5/10', sub:'Moderate â€” see insights', icon:'âš¡' },
              ].map(c => (
                <div key={c.label} className="stat-card">
                  <div className="sc-icon">{c.icon}</div>
                  <div className="sc-label">{c.label}</div>
                  <div className="sc-val">{c.val}</div>
                  <div className="sc-sub">{c.sub}</div>
                </div>
              ))}
            </div>

            {/* Charts row */}
            <div className="dash-row">
              <div className="panel">
                <div className="panel-title"><div className="dot"/>Weekly Calorie Intake</div>
                <BarChart data={seedD.calorieWeek}/>
              </div>
              <div className="panel">
                <div className="panel-title"><div className="dot" style={{background:'#69f0ae'}}/>Daily Fiber (g)</div>
                <BarChart data={seedD.fiberWeek} color="#69f0ae"/>
              </div>
            </div>

            <div className="dash-row">
              <div className="panel">
                <div className="panel-title"><div className="dot" style={{background:'#40c4ff'}}/>Step Count â€” 7 Days</div>
                <LineChart data={seedD.stepsWeek} color="#40c4ff"/>
              </div>
              <div className="panel">
                <div className="panel-title"><div className="dot" style={{background:'#ce93d8'}}/>Energy Level â€” 7 Days</div>
                <LineChart data={seedD.energyWeek} color="#ce93d8"/>
              </div>
            </div>

            <div className="dash-row three">
              {/* Symptom gauges */}
              <div className="panel">
                <div className="panel-title"><div className="dot" style={{background:'#ffab40'}}/>Symptom Severity (week avg)</div>
                <div className="gauge-list">
                  {seedD.symptoms.map(s=><GaugeBar key={s.label} {...s}/>)}
                </div>
              </div>

              {/* Energy ring */}
              <div className="panel">
                <div className="panel-title"><div className="dot" style={{background:'#ce93d8'}}/>Energy Today</div>
                <div className="energy-ring">
                  <EnergyRing score={stats.energy}/>
                  <div className="ring-info">
                    {[
                      { color:'#00e676', label:'Morning', val:'6/10' },
                      { color:'#69f0ae', label:'Afternoon', val:'5/10' },
                      { color:'#ce93d8', label:'Evening', val:'4/10' },
                    ].map(r=>(
                      <div key={r.label} className="ring-stat">
                        <div className="ring-dot" style={{background:r.color}}/>
                        <span style={{color:'var(--text-dim)',fontSize:11}}>{r.label}</span>
                        <span style={{color:'var(--text)',fontSize:12,fontFamily:'var(--mono)',marginLeft:'auto'}}>{r.val}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Insights */}
              <div className="panel">
                <div className="panel-title"><div className="dot"/>Gut Health Insights</div>
                <div className="insight-list">
                  <div className="insight-card warn"><strong>âš ï¸ Low Fiber Day</strong>Only 19g today â€” aim for 30g. Add legumes or whole grains.</div>
                  <div className="insight-card"><strong>âœ… Good Hydration</strong>6 glasses logged. Stay consistent through the evening.</div>
                  <div className="insight-card"><strong>ğŸš¶ Activity Boosts Gut</strong>Your bloating score drops on high-step days.</div>
                  <div className="insight-card danger"><strong>ğŸ˜£ Bloating Pattern</strong>Bloating noted 3 of last 7 days â€” possibly FODMAP-related.</div>
                </div>
              </div>
            </div>

            {/* Recent logs table */}
            <div className="panel" style={{marginBottom:20}}>
              <div className="panel-title"><div className="dot"/>Recent Log Entries</div>
              {logs.length === 0 ? (
                <p style={{color:'var(--text-muted)',fontSize:12,textAlign:'center',padding:'20px 0'}}>
                  No entries yet â€” start chatting to log data!
                </p>
              ) : (
                <table className="log-table">
                  <thead><tr><th>Time</th><th>Type</th><th>Details</th></tr></thead>
                  <tbody>
                    {logs.map((l,i)=>(
                      <tr key={i}>
                        <td style={{color:'var(--text-muted)',fontFamily:'var(--mono)'}}>{l.timestamp}</td>
                        <td><span className={`tag ${l.type}`}>{l.type}</span></td>
                        <td>{Object.values(l.data).slice(0,2).join(' Â· ')}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </div>
          </div>
        )}

        {/* â”€â”€ HISTORY TAB â”€â”€ */}
        {tab==='history' && (
          <div className="history-page">
            {logs.length === 0 ? (
              <div className="empty-state">
                <div className="es-icon">ğŸ“‹</div>
                <p>No log entries yet</p>
                <small>Go to the Chat tab and start telling DigestiBot about your meals, symptoms, and activity.</small>
              </div>
            ) : (
              <div className="timeline">
                <div className="timeline-day">
                  <div className="timeline-date">{today}</div>
                  <div className="timeline-entries">
                    {logs.map((l,i)=>{
                      const icons = {food:'ğŸ¥¦',activity:'ğŸƒ',symptom:'âš ï¸',energy:'âš¡'};
                      const details = Object.entries(l.data).map(([k,v])=>`${k}: ${v}`).join(' Â· ');
                      return (
                        <div key={i} className="tl-entry">
                          <span className="tl-time">{l.timestamp}</span>
                          <span className="tl-icon">{icons[l.type]||'ğŸ“'}</span>
                          <div className="tl-body">
                            <div className="tl-title">{l.title}</div>
                            <div className="tl-detail">{details}</div>
                            <div style={{marginTop:4}}><span className={`tag ${l.type}`}>{l.type}</span></div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Sample historical days */}
                {[
                  { date:'Yesterday, Feb 13', entries:[
                    { time:'08:15', icon:'ğŸ¥¦', title:'ğŸ¥¦ Food Log â€” Logged', detail:'Item(s): oatmeal, berries Â· Est. Calories: 380 kcal', type:'food' },
                    { time:'12:00', icon:'ğŸƒ', title:'ğŸƒ Activity Log â€” Logged', detail:'Activity: yoga Â· Duration: 30 min', type:'activity' },
                    { time:'19:30', icon:'âš ï¸', title:'âš ï¸ Symptom Log â€” Logged', detail:'Symptom: bloating Â· Severity: Mild (1/3)', type:'symptom' },
                    { time:'21:00', icon:'âš¡', title:'âš¡ Energy Log â€” Logged', detail:'Level: Moderate Â· Score: 6/10', type:'energy' },
                  ]},
                  { date:'Feb 12', entries:[
                    { time:'07:30', icon:'ğŸ¥¦', title:'ğŸ¥¦ Food Log â€” Logged', detail:'Item(s): eggs, toast Â· Est. Calories: 420 kcal', type:'food' },
                    { time:'17:00', icon:'ğŸƒ', title:'ğŸƒ Activity Log â€” Logged', detail:'Activity: run Â· Duration: 45 min Â· Steps: 5200', type:'activity' },
                    { time:'20:00', icon:'âš¡', title:'âš¡ Energy Log â€” Logged', detail:'Level: High Â· Score: 8/10', type:'energy' },
                  ]},
                ].map(day=>(
                  <div key={day.date} className="timeline-day">
                    <div className="timeline-date">{day.date}</div>
                    <div className="timeline-entries">
                      {day.entries.map((e,i)=>(
                        <div key={i} className="tl-entry">
                          <span className="tl-time">{e.time}</span>
                          <span className="tl-icon">{e.icon}</span>
                          <div className="tl-body">
                            <div className="tl-title">{e.title}</div>
                            <div className="tl-detail">{e.detail}</div>
                            <div style={{marginTop:4}}><span className={`tag ${e.type}`}>{e.type}</span></div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

      </main>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
